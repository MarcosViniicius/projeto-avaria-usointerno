{% extends 'base.html' %} {% block title %}Admin - Dashboard{% endblock %} {%
block content %}

<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-12">
      <!-- Header -->
      <div class="text-center mb-4">
        <div class="display-1 mb-3">‚öôÔ∏è</div>
        <h1 class="h2 text-primary fw-bold">Painel Administrativo</h1>
        <p class="text-muted">Controle e relat√≥rios do sistema</p>
      </div>

      <!-- Cards de estat√≠sticas -->
      <div class="row g-4 mb-4">
        <div class="col-12 col-md-6 col-lg-3">
          <div class="card bg-primary text-white h-100">
            <div class="card-body text-center">
              <i class="fas fa-clipboard-list fa-2x mb-3"></i>
              <h3 class="card-title">{{ stats.total_registros }}</h3>
              <p class="card-text">Total de Registros</p>
            </div>
          </div>
        </div>

        <div class="col-12 col-md-6 col-lg-3">
          <div class="card bg-success text-white h-100">
            <div class="card-body text-center">
              <i class="fas fa-calendar-day fa-2x mb-3"></i>
              <h3 class="card-title">{{ stats.registros_hoje }}</h3>
              <p class="card-text">Registros Hoje</p>
            </div>
          </div>
        </div>

        <div class="col-12 col-md-6 col-lg-3">
          <div class="card bg-warning text-white h-100">
            <div class="card-body text-center">
              <i class="fas fa-calendar-week fa-2x mb-3"></i>
              <h3 class="card-title">{{ stats.registros_semana }}</h3>
              <p class="card-text">Esta Semana</p>
            </div>
          </div>
        </div>

        <div class="col-12 col-md-6 col-lg-3">
          <div class="card bg-info text-white h-100">
            <div class="card-body text-center">
              <i class="fas fa-chart-bar fa-2x mb-3"></i>
              <h3 class="card-title">
                {{ stats.produtos_mais_registrados|length }}
              </h3>
              <p class="card-text">Produtos √önicos</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Menu de navega√ß√£o -->
      <div class="row g-3 mb-4">
        <div class="col-12 col-md-6 col-lg-3">
          <a
            href="{{ url_for('main.admin_registros') }}"
            class="btn btn-outline-primary w-100 py-3"
          >
            <i class="fas fa-list fa-2x d-block mb-2"></i>
            <strong>Ver Registros</strong>
            <br /><small>Visualizar todos os dados</small>
          </a>
        </div>

        <div class="col-12 col-md-6 col-lg-3">
          <a
            href="{{ url_for('main.admin_estatisticas') }}"
            class="btn btn-outline-success w-100 py-3"
          >
            <i class="fas fa-chart-pie fa-2x d-block mb-2"></i>
            <strong>Estat√≠sticas</strong>
            <br /><small>Gr√°ficos e an√°lises</small>
          </a>
        </div>

        <div class="col-12 col-md-6 col-lg-3">
          <div class="dropdown w-100">
            <button
              class="btn btn-outline-warning w-100 py-3 dropdown-toggle"
              type="button"
              data-bs-toggle="dropdown"
            >
              <i class="fas fa-download fa-2x d-block mb-2"></i>
              <strong>Exportar</strong>
              <br /><small>Baixar relat√≥rios</small>
            </button>
            <ul class="dropdown-menu w-100">
              <li>
                <a
                  class="dropdown-item"
                  href="{{ url_for('main.admin_exportar', formato='csv') }}"
                >
                  <i class="fas fa-file-csv me-2"></i>CSV (Excel)
                </a>
              </li>
              <li>
                <a
                  class="dropdown-item"
                  href="{{ url_for('main.admin_exportar', formato='txt') }}"
                >
                  <i class="fas fa-file-alt me-2"></i>TXT (Texto)
                </a>
              </li>
              <li>
                <a
                  class="dropdown-item"
                  href="{{ url_for('main.admin_exportar', formato='json') }}"
                >
                  <i class="fas fa-file-code me-2"></i>JSON (Dados)
                </a>
              </li>
            </ul>
          </div>
        </div>

        <div class="col-12 col-md-6 col-lg-3">
          <a
            href="{{ url_for('main.admin_limpar') }}"
            class="btn btn-outline-danger w-100 py-3"
          >
            <i class="fas fa-trash-alt fa-2x d-block mb-2"></i>
            <strong>Limpar Dados</strong>
            <br /><small>Remover registros antigos</small>
          </a>
        </div>
      </div>

      <!-- Funcionalidades de Gest√£o -->
      <div class="row g-3 mb-4">
        <div class="col-12">
          <h5 class="text-primary fw-bold mb-3">
            <i class="fas fa-cogs me-2"></i>
            Ferramentas de Gest√£o
          </h5>
        </div>

        <div class="col-12 col-md-6 col-lg-4">
          <a
            href="{{ url_for('main.admin_produtos') }}"
            class="btn btn-outline-info w-100 py-3"
          >
            <i class="fas fa-boxes fa-2x d-block mb-2"></i>
            <strong>Gest√£o de Produtos</strong>
            <br /><small>Editar produtos e c√≥digos</small>
          </a>
        </div>

        <div class="col-12 col-md-6 col-lg-4">
          <a
            href="{{ url_for('main.admin_usuarios') }}"
            class="btn btn-outline-secondary w-100 py-3"
          >
            <i class="fas fa-users fa-2x d-block mb-2"></i>
            <strong>Gest√£o de Usu√°rios</strong>
            <br /><small>Gerenciar permiss√µes</small>
          </a>
        </div>

        <div class="col-12 col-md-6 col-lg-4">
          <a
            href="{{ url_for('auth.change_password') }}"
            class="btn btn-outline-dark w-100 py-3"
          >
            <i class="fas fa-key fa-2x d-block mb-2"></i>
            <strong>Alterar Senha</strong>
            <br /><small>Seguran√ßa da conta</small>
          </a>
        </div>
      </div>

      <!-- Produtos mais registrados -->
      {% if stats.produtos_mais_registrados %}
      <div class="row">
        <div class="col-12 col-lg-8">
          <div class="card h-100">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-trophy text-warning me-2"></i>
                Top 10 - Produtos com Mais Avarias
              </h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Produto</th>
                      <th>Tipo</th>
                      <th>Registros</th>
                      <th>Peso Total</th>
                      <th>Quantidade Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for produto in stats.produtos_mais_registrados %}
                    <tr>
                      <td>{{ loop.index }}</td>
                      <td>
                        <strong>{{ produto.nome }}</strong>
                      </td>
                      <td>
                        <span
                          class="badge bg-{{ 'success' if produto.tipo == 'hortifruti' else 'primary' }}"
                        >
                          {{ 'ü•¨ Hortifr√∫ti' if produto.tipo == 'hortifruti'
                          else 'üì± Interno' }}
                        </span>
                      </td>
                      <td>
                        <span class="badge bg-secondary"
                          >{{ produto.total_registros }}</span
                        >
                      </td>
                      <td>
                        {% if produto.peso_total %} {{
                        "%.2f"|format(produto.peso_total) }} kg {% else %} - {%
                        endif %}
                      </td>
                      <td>
                        {% if produto.quantidade_total %} {{
                        produto.quantidade_total }} {% else %} - {% endif %}
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Registros recentes -->
        <div class="col-12 col-lg-4 mt-4 mt-lg-0">
          <div class="card h-100">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-clock text-info me-2"></i>
                Registros Recentes
              </h5>
            </div>
            <div class="card-body">
              {% for avaria, produto in stats.registros_recentes[:10] %}
              <div class="d-flex align-items-center mb-3 p-2 bg-light rounded">
                <div class="me-3">
                  <i
                    class="fas fa-{{ 'apple-alt' if produto.tipo == 'hortifruti' else 'barcode' }} text-{{ 'success' if produto.tipo == 'hortifruti' else 'primary' }}"
                  ></i>
                </div>
                <div class="flex-grow-1">
                  <div class="fw-bold">
                    {{ produto.nome[:20] }}{% if produto.nome|length > 20
                    %}...{% endif %}
                  </div>
                  <small class="text-muted">
                    {{ avaria.data_registro.strftime('%d/%m %H:%M') }} {% if
                    avaria.peso %} - {{ avaria.peso }}kg{% endif %} {% if
                    avaria.quantidade %} - Qtd: {{ avaria.quantidade }}{% endif
                    %}
                  </small>
                </div>
              </div>
              {% endfor %} {% if stats.registros_recentes|length > 10 %}
              <div class="text-center">
                <a
                  href="{{ url_for('main.admin_registros') }}"
                  class="btn btn-sm btn-outline-primary"
                >
                  Ver todos os registros
                </a>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Link para voltar -->
      <div class="text-center mt-4">
        <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">
          <i class="fas fa-arrow-left me-2"></i>
          Voltar ao Sistema
        </a>
      </div>
    </div>
  </div>
</div>

{% endblock %}
