{% extends 'base.html' %} {% block title %}Criar Conta - Sistema de Avarias{%
endblock %} {% block content %}

<div class="container-fluid py-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-6 col-lg-5">
      <!-- Header -->
      <div class="text-center mb-4">
        <div class="display-1 mb-3">üë§</div>
        <h1 class="h3 text-success fw-bold">Criar Conta</h1>
        <p class="text-muted">
          {% if not admin_exists %} Primeiro administrador do sistema {% else %}
          Registrar novo usu√°rio {% endif %}
        </p>
      </div>

      <!-- Aviso especial para primeiro admin -->
      {% if not admin_exists %}
      <div class="alert alert-success" role="alert">
        <h6><i class="fas fa-crown me-2"></i>Primeira Configura√ß√£o</h6>
        <p class="mb-0">
          Voc√™ est√° criando o <strong>primeiro administrador</strong> do
          sistema. Use a chave de admin: <code>admin2025</code>
        </p>
      </div>
      {% endif %}

      <!-- Card de registro -->
      <div class="card shadow-lg border-0 rounded-4">
        <div class="card-body p-4">
          <form method="POST" class="needs-validation" novalidate>
            <!-- Campo Username -->
            <div class="mb-3">
              <label for="username" class="form-label fw-semibold">
                <i class="fas fa-user text-primary me-2"></i>
                Nome de Usu√°rio
              </label>
              <input
                type="text"
                class="form-control form-control-lg"
                id="username"
                name="username"
                placeholder="Ex: admin, joao.silva"
                required
                minlength="3"
                pattern="[a-zA-Z0-9._-]+"
                autofocus
              />
              <div class="invalid-feedback">
                Usu√°rio deve ter pelo menos 3 caracteres (apenas letras,
                n√∫meros, . _ -).
              </div>
            </div>

            <!-- Campo Email -->
            <div class="mb-3">
              <label for="email" class="form-label fw-semibold">
                <i class="fas fa-envelope text-info me-2"></i>
                Email
              </label>
              <input
                type="email"
                class="form-control form-control-lg"
                id="email"
                name="email"
                placeholder="seu@email.com"
                required
              />
              <div class="invalid-feedback">
                Por favor, digite um email v√°lido.
              </div>
            </div>

            <!-- Campo Password -->
            <div class="mb-3">
              <label for="password" class="form-label fw-semibold">
                <i class="fas fa-lock text-warning me-2"></i>
                Senha
              </label>
              <input
                type="password"
                class="form-control form-control-lg"
                id="password"
                name="password"
                placeholder="M√≠nimo 6 caracteres"
                required
                minlength="6"
              />
              <div class="invalid-feedback">
                A senha deve ter pelo menos 6 caracteres.
              </div>
            </div>

            <!-- Campo Confirmar Password -->
            <div class="mb-3">
              <label for="confirm_password" class="form-label fw-semibold">
                <i class="fas fa-lock text-warning me-2"></i>
                Confirmar Senha
              </label>
              <input
                type="password"
                class="form-control form-control-lg"
                id="confirm_password"
                name="confirm_password"
                placeholder="Digite a senha novamente"
                required
              />
              <div class="invalid-feedback">As senhas devem coincidir.</div>
            </div>

            <!-- Chave de Admin (apenas se n√£o existe admin) -->
            {% if not admin_exists %}
            <div class="mb-4">
              <label for="admin_key" class="form-label fw-semibold">
                <i class="fas fa-key text-danger me-2"></i>
                Chave de Administrador
              </label>
              <input
                type="password"
                class="form-control form-control-lg"
                id="admin_key"
                name="admin_key"
                placeholder="Digite: admin2025"
                required
              />
              <small class="form-text text-muted">
                Esta chave √© necess√°ria para criar o primeiro administrador.
              </small>
              <div class="invalid-feedback">
                Por favor, digite a chave de administrador.
              </div>
            </div>
            {% endif %}

            <!-- Bot√£o de registro -->
            <button
              type="submit"
              class="btn btn-success btn-lg w-100 py-3 rounded-3"
            >
              <i class="fas fa-user-plus me-2"></i>
              {% if not admin_exists %} Criar Primeiro Admin {% else %} Criar
              Conta {% endif %}
            </button>
          </form>
        </div>
      </div>

      <!-- Links √∫teis -->
      <div class="text-center mt-4">
        <div class="card bg-light border-0 rounded-4">
          <div class="card-body p-3">
            <small class="text-muted">
              <strong>J√° tem uma conta?</strong><br />
              <a
                href="{{ url_for('auth.login') }}"
                class="text-decoration-none"
              >
                Fa√ßa login aqui
              </a>
            </small>
          </div>
        </div>
      </div>

      <!-- Voltar -->
      <div class="text-center mt-3">
        <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">
          <i class="fas fa-arrow-left me-2"></i>
          Voltar ao Sistema
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script>
  // Valida√ß√£o do formul√°rio
  (function () {
    "use strict";
    window.addEventListener(
      "load",
      function () {
        var forms = document.getElementsByClassName("needs-validation");
        var validation = Array.prototype.filter.call(forms, function (form) {
          form.addEventListener(
            "submit",
            function (event) {
              var password = document.getElementById("password").value;
              var confirmPassword =
                document.getElementById("confirm_password").value;

              // Verificar se senhas coincidem
              if (password !== confirmPassword) {
                document
                  .getElementById("confirm_password")
                  .setCustomValidity("As senhas n√£o coincidem");
              } else {
                document
                  .getElementById("confirm_password")
                  .setCustomValidity("");
              }

              if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
              }
              form.classList.add("was-validated");
            },
            false
          );
        });
      },
      false
    );
  })();

  // Verificar senhas em tempo real
  document
    .getElementById("confirm_password")
    .addEventListener("input", function () {
      var password = document.getElementById("password").value;
      var confirmPassword = this.value;

      if (password !== confirmPassword) {
        this.setCustomValidity("As senhas n√£o coincidem");
      } else {
        this.setCustomValidity("");
      }
    });
</script>

{% endblock %}
