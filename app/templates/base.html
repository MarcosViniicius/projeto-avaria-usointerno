<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />
    <title>{% block title %}Sistema de Avarias{% endblock %}</title>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0d6efd" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Sistema Avarias" />

    <!-- Manifest para PWA -->
    <link
      rel="manifest"
      href="{{ url_for('static', filename='manifest.json') }}"
    />

    <!-- Favicon -->
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì¶</text></svg>"
    />

    <style>
      :root {
        --primary-color: #0d6efd;
        --success-color: #198754;
        --warning-color: #ffc107;
        --danger-color: #dc3545;
        --dark-color: #212529;
        --light-color: #f8f9fa;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        overflow-x: hidden;
      }

      .container-fluid {
        max-width: 1200px;
      }

      .card {
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.18);
      }

      .btn {
        font-weight: 600;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      .form-control {
        border-radius: 12px;
        border: 2px solid #e9ecef;
        transition: border-color 0.3s ease;
      }

      .form-control:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
      }

      .navbar-brand {
        font-weight: 700;
        font-size: 1.5rem;
      }

      /* Anima√ß√µes suaves */
      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Melhorias para mobile */
      @media (max-width: 768px) {
        .container-fluid {
          padding-left: 1rem;
          padding-right: 1rem;
        }

        .display-1 {
          font-size: 3rem;
        }
      }

      /* Loading state */
      .loading {
        pointer-events: none;
        opacity: 0.6;
      }

      .loading::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        margin: -10px 0 0 -10px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="fade-in">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
      <div class="container-fluid">
        <a class="navbar-brand" href="{{ url_for('main.index') }}">
          <i class="fas fa-boxes me-2"></i>
          Sistema de Avarias
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('main.index') }}">
                <i class="fas fa-home me-1"></i> In√≠cio
              </a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                href="{{ url_for('main.registro_hortifruti') }}"
              >
                <i class="fas fa-apple-alt me-1"></i> Hortifr√∫ti
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('main.registro_interno') }}">
                <i class="fas fa-barcode me-1"></i> Uso Interno
              </a>
            </li>
            {% if current_user.is_authenticated %}
            <li class="nav-item">
              <a
                class="nav-link text-warning"
                href="{{ url_for('main.admin_dashboard') }}"
              >
                <i class="fas fa-cog me-1"></i> Admin
              </a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="fas fa-user me-1"></i>
                {{ current_user.username }} {% if current_user.is_admin %}
                <span class="badge bg-warning text-dark ms-1">Admin</span>
                {% endif %}
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('auth.change_password') }}"
                  >
                    <i class="fas fa-key me-2"></i>Alterar Senha
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a
                    class="dropdown-item text-danger"
                    href="{{ url_for('auth.logout') }}"
                  >
                    <i class="fas fa-sign-out-alt me-2"></i>Sair
                  </a>
                </li>
              </ul>
            </li>
            {% else %}
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('auth.login') }}">
                <i class="fas fa-sign-in-alt me-1"></i> Entrar
              </a>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <!-- Conte√∫do principal -->
    <main>
      <!-- Flash Messages -->
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %}
      <div class="container-fluid mt-3">
        <div class="row justify-content-center">
          <div class="col-12 col-md-8 col-lg-6">
            {% for category, message in messages %}
            <div
              class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show"
              role="alert"
            >
              <i
                class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-triangle' }} me-2"
              ></i>
              {{ message }}
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="alert"
                aria-label="Close"
              ></button>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %} {% endwith %} {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="mt-5 py-4 text-center text-white-50">
      <div class="container">
        <small>
          <i class="fas fa-heart text-danger"></i>
          Sistema desenvolvido com carinho para facilitar o trabalho
        </small>
      </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Scripts customizados -->
    {% block scripts %}{% endblock %}

    <!-- PWA Service Worker -->
    <script>
      // Registrar Service Worker para PWA
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("/static/sw.js")
          .catch(function (error) {
            console.log("Service Worker registration failed:", error);
          });
      }

      // Adicionar classe para anima√ß√µes
      document.addEventListener("DOMContentLoaded", function () {
        document.body.classList.add("fade-in");
      });
    </script>
  </body>
</html>
